<layout name="../../Layout/layout" />
<script type="text/javascript">
		$(function(){
			$('.jqzoom').jqzoom({
	            zoomType: 'standard',
	            lens:true,
	            preloadImages: false,
	            alwaysOn:false,
	            title:false,
	            zoomWidth:400,
	            zoomHeight:400
	        });
		})
	</script>
<!-- 商品页面主体 start -->
	<div class="main w1210 mt10 bc">
		<!-- 面包屑导航 start -->
		<div class="breadcrumb">
			<h2>当前位置：<a href="">首页</a> > <a href="">电脑、办公</a> > <a href="">笔记本</a> > <?php echo $info['goods_name']; ?></h2>
		</div>
		<!-- 面包屑导航 end -->
		
		<!-- 主体页面左侧内容 start -->
		<div class="goods_left fl">
			<!-- 相关分类 start -->
			<div class="related_cat leftbar mt10">
				<h2><strong>相关分类</strong></h2>
				<div class="leftbar_wrap">
					<ul>
						<li><a href="">笔记本</a></li>
						<li><a href="">超极本</a></li>
						<li><a href="">平板电脑</a></li>
					</ul>
				</div>
			</div>
			<!-- 相关分类 end -->

			<!-- 相关品牌 start -->
			<div class="related_cat	leftbar mt10">
				<h2><strong>同类品牌</strong></h2>
				<div class="leftbar_wrap">
					<ul>
						<li><a href="">D-Link</a></li>
						<li><a href="">戴尔</a></li>
						<li><a href="">惠普</a></li>
						<li><a href="">苹果</a></li>
						<li><a href="">华硕</a></li>
						<li><a href="">宏基</a></li>
						<li><a href="">神舟</a></li>
					</ul>
				</div>
			</div>
			<!-- 相关品牌 end -->

			<!-- 热销排行 start -->
			<div class="hotgoods leftbar mt10">
				<h2><strong>热销排行榜</strong></h2>
				<div class="leftbar_wrap">
					<ul>
						<li></li>
					</ul>
				</div>
			</div>
			<!-- 热销排行 end -->


			<!-- 浏览过该商品的人还浏览了  start 注：因为和list页面newgoods样式相同，故加入了该class -->
			<div class="related_view newgoods leftbar mt10">
				<h2><strong>浏览了该商品的用户还浏览了</strong></h2>
				<div class="leftbar_wrap">
					<ul>
						<?php foreach ($og as $k => $v): ?>
						<li>
							<dl>
								<dt><a href="__ACTION__/id/<?php echo $v['id']; ?>"><img src="<?php echo IMG_URL . $v['mid_logo']; ?>" alt="" /></a></dt>
								<dd><a href="__ACTION__/id/<?php echo $v['id']; ?>"><?php echo $v['goods_name']; ?></a></dd>
								<dd><strong>￥<?php echo $v['shop_price']; ?>元</strong></dd>
							</dl>
						</li>
						<?php endforeach; ?>		
					</ul>
				</div>
			</div>
			<!-- 浏览过该商品的人还浏览了  end -->

			<!-- 最近浏览 start -->
			<div class="viewd leftbar mt10">
				<h2><a href="">清空</a><strong>最近浏览过的商品</strong></h2>
				<div class="leftbar_wrap">
					<dl>
						<dt><a href=""><img src="__PUBLIC__/images/hpG4.jpg" alt="" /></a></dt>
						<dd><a href="">惠普G4-1332TX 14英寸笔记...</a></dd>
					</dl>

					<dl class="last">
						<dt><a href=""><img src="__PUBLIC__/images/crazy4.jpg" alt="" /></a></dt>
						<dd><a href="">直降200元！TCL正1.5匹空调</a></dd>
					</dl>
				</div>
			</div>
			<!-- 最近浏览 end -->

		</div>
		<!-- 主体页面左侧内容 end -->
		
		<!-- 商品信息内容 start -->
		<div class="goods_content fl mt10 ml10">
			<!-- 商品概要信息 start -->
			<div class="summary">
				<h3><strong><?php echo $info['goods_name']; ?></strong></h3>
				
				<!-- 图片预览区域 start -->
				<div class="preview fl">
					<div class="midpic">
						<a href="<?php echo IMG_URL . $info['logo']; ?>" class="jqzoom" rel="gal1">   <!-- 第一幅图片的大图 class 和 rel属性不能更改 -->
							<img src="<?php echo IMG_URL . $info['big_logo']; ?>" alt="" />               <!-- 第一幅图片的中图 -->
						</a>
					</div>
	
					<!--使用说明：此处的预览图效果有三种类型的图片，大图，中图，和小图，取得图片之后，分配到模板的时候，把第一幅图片分配到 上面的midpic 中，其中大图分配到 a 标签的href属性，中图分配到 img 的src上。 下面的smallpic 则表示小图区域，格式固定，在 a 标签的 rel属性中，分别指定了中图（smallimage）和大图（largeimage），img标签则显示小图，按此格式循环生成即可，但在第一个li上，要加上cur类，同时在第一个li 的a标签中，添加类 zoomThumbActive  -->

					<div class="smallpic">
						<a href="javascript:;" id="backward" class="off"></a>
						<a href="javascript:;" id="forward" class="on"></a>
						<div class="smallpic_wrap">
							<ul>
								<li class="cur">
									<a class="zoomThumbActive" href="javascript:void(0);" rel="{gallery: 'gal1', smallimage: '<?php echo IMG_URL . $info['big_logo']; ?>',largeimage: '<?php echo IMG_URL . $info['logo']; ?>'}"><img src="<?php echo IMG_URL . $info['sm_logo']; ?>"></a>
								</li>
								<?php foreach ($gpData as $k => $v): ?>
								<li>
									<a href="javascript:void(0);" rel="{gallery: 'gal1', smallimage: '<?php echo IMG_URL . $v['mid_logo']; ?>',largeimage: '<?php echo IMG_URL . $v['logo']; ?>'}"><img src="<?php echo IMG_URL . $v['sm_logo']; ?>"></a>
								</li>
								<?php endforeach; ?>
							</ul>
						</div>
						
					</div>
				</div>
				<!-- 图片预览区域 end -->

				<!-- 商品基本信息区域 start -->
				<div class="goodsinfo fl ml10">
					<ul>
						<li><span>商品编号： </span><?php echo $info['id']; ?></li>
						<li class="market_price"><span>定价：</span><em>￥<?php echo $info['market_price']; ?></em></li>
						<li class="shop_price"><span>本店价：</span> <strong>￥<?php echo $info['shop_price']; ?></strong> <a href="">(降价通知)</a></li>
						<li><span>会员价格：</span><span id="member_price"></span></li>
						<li class="star"><span>商品评分：</span> <strong></strong><a href="">(已有21人评价)</a></li> <!-- 此处的星级切换css即可 默认为5星 star4 表示4星 star3 表示3星 star2表示2星 star1表示1星 -->
					</ul>
					<form action="__MODULE__/Cart/addToCart" method="post" class="choose">
						<input type="hidden" name="gid" value="<?php echo I('get.id'); ?>" />
						<ul>
							<?php foreach ($rga as $k => $v): ?>
							<li class="product">
								<dl>
									<dt><?php echo $v[0]['attr_name']; ?>：</dt>
									<dd>
										<?php foreach ($v as $k1 => $v1): ?>
										<a <?php if($k1 == 0) echo 'class="selected"'; ?> href="javascript:;">
											<?php echo $v1['attr_value']; ?> 
											<input class="ga" type="radio" name="gaId[<?php echo $v1['attr_id']; ?>]" value="<?php echo $v1['id']; ?>" <?php if($k1 == 0) echo 'checked="checked"'; ?> />
										</a>
										<?php endforeach; ?>
									</dd>
								</dl>
							</li>
							<?php endforeach; ?>
							
							<li>
								<dl>
									<dt>购买数量：</dt>
									<dd>
										<a href="javascript:;" id="reduce_num"></a>
										<input type="text" name="amount" value="1" class="amount"/>
										<a href="javascript:;" id="add_num"></a>
										<span></span>
									</dd>
								</dl>
							</li>

							<li>
								<dl>
									<dt>&nbsp;</dt>
									<dd>
										<input type="submit" value="" class="add_btn" />
									</dd>
								</dl>
							</li>

						</ul>
					</form>
				</div>
				<!-- 商品基本信息区域 end -->
			</div>
			<!-- 商品概要信息 end -->
			
			<div style="clear:both;"></div>

			<!-- 商品详情 start -->
			<div class="detail">
				<div class="detail_hd">
					<ul>
						<li class="first"><span>商品介绍</span></li>
						<li class="on"><span>商品评价</span></li>
						<li><span>售后保障</span></li>
					</ul>
				</div>
				<div class="detail_bd">
					<!-- 商品介绍 start -->
					<div class="introduce detail_div none">
						<div class="attr mt15">
							<ul>
								<li><span>商品名称：</span>ThinkPadX230(2306 3T4）</li>
								<li><span>商品编号：</span>979631</li>
								<li><span>品牌：</span>联想（Thinkpad）</li>
								<li><span>上架时间：</span>2013-09-18 17:58:12</li>
								<li><span>商品毛重：</span>2.47kg</li>
								<li><span>商品产地：</span>中国大陆</li>
								<li><span>显卡：</span>集成显卡</li>
								<li><span>触控：</span>非触控</li>
								<li><span>厚度：</span>正常厚度（>25mm）</li>
								<li><span>处理器：</span>Intel i5</li>
								<li><span>尺寸：</span>12英寸</li>
							</ul>
						</div>

						<div class="desc mt10">
							<!-- 此处的内容 一般是通过在线编辑器添加保存到数据库，然后直接从数据库中读出 -->
							<img src="__PUBLIC__/images/desc1.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc2.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc3.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc4.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc5.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc6.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc7.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc8.jpg" alt="" />
							<p style="height:10px;"></p>
							<img src="__PUBLIC__/images/desc9.jpg" alt="" />
						</div>
					</div>
					<!-- 商品介绍 end -->
					
					<!-- 商品评论 start -->
					<div class="comment detail_div mt10">
						<div class="comment_summary">
							<div class="rate fl">
								<strong><em><span class="hao"></span></em>%</strong> <br />
								<span>好评度</span>
							</div>
							<div class="percent fl">
								<dl>
									<dt>好评（<span class="hao"></span>%）</dt>
									<dd><div class="hao_div"></div></dd>
								</dl>
								<dl>
									<dt>中评（<span class="zhong"></span>%）</dt>
									<dd><div class="zhong_div"></div></dd>
								</dl>
								<dl>
									<dt>差评（<span class="cha"></span>%）</dt>
									<dd><div class="cha_div"></div></dd>
								</dl>
							</div>
							<div class="buyer fl">
								<dl>
									<dt>买家印象：</dt>
								</dl>
							</div>
						</div>
						<div id="remark_container"></div>
						<a id="loadMore" href="javascript:void(0);" style="padding:5px;background:#EEE;text-align:center;display:block;margin-top:5px;">加载更多</a>
						<!--  评论表单 start-->
						<div class="comment_form mt20">
							<form action="" name="remark_form">
								<input type="hidden" name="goods_id" value="<?php echo I('get.id'); ?>" />
								<ul>
									<li>
										<label for=""> 评分：</label>
										<input type="radio" name="stars" value="5" checked="checked" /> <strong class="star star5"></strong>
										<input type="radio" name="stars" value="4" /> <strong class="star star4"></strong>
										<input type="radio" name="stars" value="3" /> <strong class="star star3"></strong>
										<input type="radio" name="stars" value="2" /> <strong class="star star2"></strong>
										<input type="radio" name="stars" value="1" /> <strong class="star star1"></strong>
									</li>
									<li>
										<label for="">评价内容：</label>
										<textarea name="content" id="" cols="" rows=""></textarea>
									</li>
									<li>
										<label for="">印象：</label>
										<input type="text" name="yx_name" />
									</li>
									<li>
										<label for="">&nbsp;</label>
										<input type="button" value="提交评论"  class="comment_btn"/>										
									</li>
								</ul>
							</form>
						</div>
						<!--  评论表单 end-->
						
					</div>
					<!-- 商品评论 end -->

					<!-- 售后保障 start -->
					<div class="after_sale mt15 none detail_div">
						<div>
							<p>本产品全国联保，享受三包服务，质保期为：一年质保 <br />如因质量问题或故障，凭厂商维修中心或特约维修点的质量检测证明，享受7日内退货，15日内换货，15日以上在质保期内享受免费保修等三包服务！</p>
							<p>售后服务电话：800-898-9006 <br />品牌官方网站：http://www.lenovo.com.cn/</p>

						</div>

						<div>
							<h3>服务承诺：</h3>
							<p>本商城向您保证所售商品均为正品行货，京东自营商品自带机打发票，与商品一起寄送。凭质保证书及京东商城发票，可享受全国联保服务（奢侈品、钟表除外；奢侈品、钟表由本商城联系保修，享受法定三包售后服务），与您亲临商场选购的商品享受相同的质量保证。本商城还为您提供具有竞争力的商品价格和运费政策，请您放心购买！</p> 
							
							<p>注：因厂家会在没有任何提前通知的情况下更改产品包装、产地或者一些附件，本司不能确保客户收到的货物与商城图片、产地、附件说明完全一致。只能确保为原厂正货！并且保证与当时市场上同样主流新品一致。若本商城没有及时更新，请大家谅解！</p>

						</div>
						
						<div>
							<h3>权利声明：</h3>
							<p>本商城上的所有商品信息、客户评价、商品咨询、网友讨论等内容，是京东商城重要的经营资源，未经许可，禁止非法转载使用。</p>
							<p>注：本站商品信息均来自于厂商，其真实性、准确性和合法性由信息拥有者（厂商）负责。本站不提供任何保证，并不承担任何法律责任。</p>

						</div>
					</div>
					<!-- 售后保障 end -->

				</div>
			</div>
			<!-- 商品详情 end -->

			
		</div>
		<!-- 商品信息内容 end -->
		

	</div>
	<!-- 商品页面主体 end -->

<script>
_updateHis();
function _updateHis()
{
	// 如果AJAX没有执行完再推迟0.5秒
	if(_chk_login_done_ == 0)
		setTimeout(_updateHis, 500);
	else
	{
		// 下面的代码只有在AJAX判断完登录之后才会被执行
		if(__mid__ > 0)
		{
			$.ajax({
				type : "GET",
				url : "__CONTROLLER__/ajaxIncHistory/gid/<?php echo I('get.id'); ?>"
			});
		}
	}
}
// 点击评论时AJAX提交表单
$(".comment_btn").click(function(){
	// 判断有没有评分
	var starsOk = false;
	// 循环五个单选框
	$("input[name=stars]").each(function(){
		// 只要有一个是选中的就不用再循环后面的了
		if($(this).attr("checked"))
		{
			starsOk = true;
			return false;   // 退出循环
		}
	});
	// 如果循环完之后还是false说明一个也没选
	if(!starsOk)
	{
		alert("必须打分！");
		return false;
	}
	if($.trim($("textarea[name=content]").val()) == "")
	{
		alert("评论内容不能为空！");
		return false;
	}
	if($.trim($("input[name=goods_id]").val()) == "")
	{
		alert("参数无效！");
		return false;
	}
	var d = $("form[name=remark_form]").serialize();
	$.ajax({
		type : "POST",
		url : "__CONTROLLER__/ajaxRemark",
		data : d,
		dataType : "json",
		success : function(data)
		{
			if(data.error == 0)
			{
				
			}
			else
			{
				alert(data.message);
			}
		}
	});
});
// 评论的总页数
var tp;
// 获取某一页的评论数据
function ajaxGetPl(page)
{
	$.ajax({
		type : "GET",
		url : "__CONTROLLER__/ajaxGetPl/gid/<?php echo I('get.id'); ?>/p/"+page,
		dataType : "json",
		success : function(data)
		{
			if(page == 1)
			{
				// 印象
				var yxstr = '';
				$(data.yx).each(function(k,v){
					yxstr += '<dd><span>'+v.yx_name+'</span><em>('+v.yx_count+')</em></dd>';
				});
				$(".buyer dl").append(yxstr);
				// 好评率
				$(".hao").html(data.hao);
				$(".zhong").html(data.zhong);
				$(".cha").html(data.cha);
				$(".hao_div").css("width",data.hao+"px");
				$(".zhong_div").css("width",data.zhong+"px");
				$(".cha_div").css("width",data.cha+"px");
				tp = data.tp;
			}
			// 把评论的数据放到页面中
			var ylhtml = "";
			$(data.data).each(function(k,v){
				ylhtml += '<div class="comment_items mt10"><div class="user_pic"><dl><dt><a href=""><img src="/Public/images/default_face.jpg" alt="" /></a></dt><dd><a href="">'+v.username+'</a></dd></dl></div><div class="item" style="min-height:80px;"><div class="title"><span>'+v.addtime+'</span><strong class="star star'+v.stars+'"></strong></div><div class="comment_content">'+v.content+'</div></div><div class="cornor"></div></div>';
			});
			$("#remark_container").append(ylhtml);
		}
	});
}

var cur_page = 1;
$("#loadMore").click(function(){
	if(++cur_page <= tp)
		ajaxGetPl(cur_page);
	else
	{
		$("#loadMore").html("没有更多了");
		$("#loadMore").unbind("click");
	}
});

// 为滚动条绑定一个滚动的事件
// 获取当前窗口的高度
var wh = $(window).innerHeight();
// 获取评论所在位置距离上面的距离
var co = $(".comment").offset();
$(window).scroll(function(){
	// 滚动的高度
	var st = $(this).scrollTop();
	if((wh+st-100) > co.top)
	{
		ajaxGetPl(1);
		$(window).unbind("scroll");
	}
});
// 计算会员价格 --> 必须在上面的AJAX判断登录完之后再执行
_computMemberPrice();
function _computMemberPrice()
{
	// 如果AJAX没有执行完再推迟0.5秒
	if(_chk_login_done_ == 0)
		setTimeout(_computMemberPrice, 500);
	else
	{
		// 下面的代码只有在AJAX判断完登录之后才会被执行
		// 如果登录了就计算会员价格
		if(__mid__ > 0)
		{
			$.ajax({
				type : "GET",
				url : "__CONTROLLER__/ajaxGetMemberPrice/gid/<?php echo I('get.id'); ?>",
				success : function(data)
				{
					$("#member_price").html(data);
				}
			});
		}
	}
}
function numPK(v1,v2)
{
	if(parseInt(v1)<parseInt(v2))
		return -1;
	else if(parseInt(v1)>parseInt(v2))
		return 1;
	else
		return 0;
}
// 获取当前商品的库存量
function ajaxGetGN()
{
	// 获取当前页面中选中的商品属性ID
	var gaid = [];
	$(".ga").each(function(k,v){
		if($(v).attr("checked"))
		{
			gaid.push($(v).val());
		}
	});
	gaid.sort(numPK);  // 升序排列
	gaid = gaid.join(",");
	$.ajax({
		type : "GET",
		url : "__CONTROLLER__/ajaxGetGN/gid/<?php echo I('get.id'); ?>/gaid/"+gaid,
		success : function(data)
		{
			$("#add_num").next("span").html(data);
		}
	});
}
ajaxGetGN();
</script>